#!/bin/sh -e

printf "Updating Typography package list..."

libdir=/usr/lib/ocaml/Typography/
destmeta=$libdir/META

cat > $destmeta <<EOF
# DO NOT EDIT THIS FILE -- YOUR CHANGES WILL BE OVERWRITTEN
# This file is generated by libtypography-ocaml-dev postinstall
# script/trigger.
name="Typography"
version="1.0"
description="Typography library"
requires="str,camomile,zip,camlimages.all_formats"
archive(native)="Typography.cmxa, DefaultFormat.cmxa"
archive(byte)="Typography.cma, DefaultFormat.cma"
EOF

for file in $libdir/*.cma
do
  basefile=`basename $file .cma`
  if [ $basefile != "Typography" ]
  then
    if [ -r $libdir/META.d/$basefile.META ]
    then
      cat $libdir/META.d/$basefile.META >> $destmeta
    else
      echo "package \"$basefile\" (" >> $destmeta
      echo "archive(byte)=\"$basefile.cma\"" >> $destmeta
  
      if [ -r "$libdir/$basefile.cmxa" ]
      then
        echo "archive(native)=\"$basefile.cmxa\"" >> $destmeta
      fi
  
      echo ")" >> $destmeta
    fi
  fi
done

printf " done.\n"

#DEBHELPER#
